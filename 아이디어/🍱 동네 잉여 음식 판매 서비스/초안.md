# 동네 잉여 음식 판매 서비스 – 환경 중심 MVP 기획서 (v0.3)

> 핵심 가치: **환경**. ‘재미’나 과도한 게이미피케이션이 아니라, **실제 감축 효과**를 데이터로 보여주고 보상합니다. 배달은 **없음(픽업 전용)**, **제로포장/다회용 루프** 중심.


- **환경** 중심 가치
- **배달 없음** → 오직 **픽업 기반**, 동네 단위 서비스
- **포인트 제도** → 환경 기여도 기반 적립
- **가게 평점 없음**, 대신 **신뢰도 + 환경 기여도** 지표 제공
- **제로포장 + 다회용 루프** 운영
- **오픈 환경 대시보드** → 음식 폐기 감축·포장재 절감 등 실시간 공개
- **식품 기부** → 지자체·학교·기업과 연계
- **게이미피케이션**은 단순 소비가 아닌 **환경 기여 중심**

#### 대상
- 판매자 : 식당, 카페, 편의점, 베이커리 등
- 소비자(B2C) :환경에 관심있는 주민, 동네 기반 소비자
- 기관/단체(B2B) : 지자체, 학교, 복지 기관, 기업

#### 주요 기능
- **픽업 플랜 생성**: 출발 위치·시간·이동수단 기준 최적 경로 설계, 경로 주변 추천 포함
- **대리 픽업(공유 토큰)**: 가족·친구가 대신 수령 가능 (친구 추가X)
- **환경 포인트 적립**: 음식 폐기·포장재 절감·배달 회피 효과 기반
- **오픈 환경 대시보드**: 지역별 감축량, 다회용기 순환률 공개
- **단체 기부**: 판매 불가 잉여 식품을 지자체·학교·기업 등과 연계 기부
- **신뢰도 시스템**: 별점 대신 정시 수령률, 포장 정책 이행률 등 지표 기반
	
---

## 0. 요약

- **목표**: 동네 내 당일 잉여 식품을 소비자에게 연결하여 _음식 폐기_와 _일회용 포장/운송 배출_을 줄임.
    
- **정책**: 배달 금지(픽업만), 제로포장/다회용기 우대, 환경지표 공개.
    
- **핵심 기능**: 경로 기반 **픽업 플랜 생성**, **환경 포인트** 및 **오픈 환경 대시보드**, **신뢰도(별점 없음)**, **대리 픽업 토큰**.
    
- **타깃**: 환경에 관심 있는 일반 소비자·지역 소상공인.
    

---

## 1. 서비스 목표 & 가치

- 음식 폐기량 감축, 포장재 감축, 운송(배달) 회피로 인한 **탄소/자원 절감**을 실측·산출.
    
- 구매·픽업 행위를 **환경 기여 행동**으로 정량화하여 리워드.
    
- 지역 커뮤니티 단위(동/구)로 성과를 **공개**하고, 선한 경쟁 유도.
    

## 2. 타깃 세그먼트

- **판매자(Partner)**: 식당·카페·베이커리·편의점 등 마감 잉여가 주기적으로 발생하는 소상공인.
    
- **소비자(User)**: 가격보다 환경 동기가 강한 주민(걷기/자전거 선호, 다회용기 보유 등).
    
- **운영자(Admin)**: 입점/검수/정산·환경지표 검증·신고 처리.
    

## 3. 핵심 정책

- **배달 없음**: 픽업 전용. 서비스 반경은 동네(예: 1~3km) 기준.
    
- **제로포장/다회용 루프**: 일회용 금지 옵션 제공. 다회용기 **보증금(Deposit)** 기반 회수 루프 운영.
    
- **오픈 환경 대시보드**: 지역/기간별 감축량을 **실시간에 가깝게** 공개(지연 가능).
    
- **별점 금지, 신뢰도 도입**: 정량 지표 기반(정시 수령률, 품질 이슈율, 재고 정확도 등).
    
- **기부 연계**: 판매 불가 재고는 **지자체/학교/기업 복지·단체**에 기부 경로 제공.
    

---

## 4. 사용자 여정(Consumer)

1. **가입/로그인**(소셜/이메일) → **동네 설정**(행정동/반경)
    
2. **상품 탐색**(지도·리스트, 픽업 시간/거리/포장 유형 필터)
    
3. **상세 보기**(원가/할인가, 픽업 윈도우, 제로포장/다회용 옵션)
    
4. **결제 → 픽업**(현장 QR/핀코드 검증)
    
5. **환경 기여 확인**(CO₂/포장 감축, 걷기/자전거 실적) & **포인트 적립**
    

## 5. 사용자 여정(Partner)

- **입점 신청·승인** → **잉여 상품 등록**(수량·가격·픽업 시간·포장 정책) → **실시간 재고/판매 현황** → **정산**
    

---

## 6. 픽업 플랜(경로) 기능

> 한 번의 외출로 여러 매장을 효율적으로 들러 **시간·이동거리**를 줄이고, **환경 기여**를 극대화

### 6.1 플로우 (사용자 제공 시나리오 반영)

1. **픽업 플랜 만들기** 클릭
    
2. **출발 위치 + 출발 예상 시간**, **이동수단(도보/자전거/버스)**, **귀가 여부** 선택
    
3. 지도에서 **경로 주변 추천 오퍼** 표시 → 사용자가 추가 선택 시 **즉시 재최적화**
    
4. **확정** → 각 매장에 **예상 도착 알림** 발송(변경 시 자동 갱신)
    

### 6.2 제약·데이터

- **시간 윈도우**: 매장별 픽업 가능 시간
    
- **모드**: 도보/자전거/대중교통(환승 패널티)
    
- **용량/부피**: 장바구니/가방 용량, 음식 부피/중량
    
- **날씨**: 강수/체감온도/미세먼지에 따른 모드·준비물 추천
    

### 6.3 최적화 접근

- **Haversine + OSRM/GraphHopper** 기반 ETA/거리 계산
    
- **시간창(TW) TSP/VRP** 휴리스틱: 최근접 삽입 + 2-opt, 늦은 마감 우선 패널티
    
- 재최적화는 **증분**(선택 지점만 재연결)으로 UX 지연 최소화
    

### 6.4 주변 추천(경로 인접 오퍼)

- 경로로부터 **거리 d 미터** 버퍼 내, **픽업 시간 호환** + **환경 가중치(제로포장/다회용)** 높은 순 추천
    

### 6.5 준비물/교통수단 추천

- **용량·거리·날씨** 조합으로 “장바구니/보냉팩/우비/보온병/텀블러” 체크리스트 자동 생성
    

---

## 7. 대리 픽업(가족/친구) – **공유 토큰** 설계

- 주문마다 **Pickup Share Token**(UUID+서명, 만료 포함) 1회용 발급
    
- 구매자가 **토큰을 공유** → 수령자가 앱에서 **수락**하면 자신의 **픽업 플랜에 추가**
    
- 매장 수령 시 **QR + 6자리 PIN**(토큰에 포함) 제시 → 서버 검증 후 인도
    
- **권한 범위 최소화**: 주문 내역 전체가 아니라 **해당 주문 수령 권한만** 위임
    
- **취소/만료/회수** 가능, 수령 완료 시 토큰 자동 폐기
    
- **남용 방지**: 위치/시간 로그, 비정상 공유 패턴 모니터링
    

---

## 8. 환경 포인트 & 지표(가치 중심 보상)

> **별점 대신** 신뢰도와 환경 기여 지표를 전면에

### 8.1 포인트 구조(초안)

- **음식 폐기 회피**: _kg 음식_ × **배출계수**(gCO₂e/kg)
    
- **포장재 감축**: 컵/뚜껑/용기/봉투 **개수** × **항목별 계수**
    
- **배달 회피**: 기본 배달 대체 거리 × **교통수단 계수**(도보/자전거=0, 버스·지하철 저배출, 자가용/오토바이 대비 절감)
    
- **보너스**: 다회용기 회수 루프 참여, 우천 시 도보/자전거 이용 등
    

> 실제 계수는 LCA/공공데이터 값을 바탕으로 **환경 팩터 테이블**에서 관리(지역·시즌 갱신 가능). 초기엔 보수적 기본값, 추후 검증하며 보정.

### 8.2 신뢰도(판매자/소비자)

- **판매자**: 정시 픽업 완료율, 재고 정확도, 품질 이슈율, 제로포장 이행률
    
- **소비자**: 노쇼율(사전 취소는 불이익 완화), 대리픽업 남용, 다회용기 반납률
    
- 공개는 **지표 위주**로, 텍스트 리뷰 최소화(악성 리뷰 노이즈 방지)
    

---

## 9. 오픈 환경 대시보드(지역 공개)

- **단위**: 동/구/시, 주·월·누적
    
- **항목**: 음식 폐기 감축(kg), 포장재 절감(개/kg), 배달 회피 거리(km), CO₂e 절감(kg), 다회용기 순환율(%)
    
- **랭킹**: 동네/매장/개인 TOP(익명·비식별 집계), **k-익명성** 임계치 미달 시 비공개
    
- **실시간성**: 거래 확정/픽업 확정 시점에 집계(최대 수분~수시간 지연)
    

---

## 10. 기부 모델(지자체·학교·기업 연계)

- 판매 불가 잉여는 **기부 전환**: 매장 → 지정 단체 **수거/픽업 슬롯** 배정
    
- **영수증/증빙** 발급(사업자·단체 회계용), 알레르겐/보관 조건 표시
    
- **품질/위생 가이드**: 냉장·유통기한·자발적 기준; 신고/회수 프로세스 포함
    

---

## 11. 데이터 모델(스키마 초안)

- **users(id, email, name, role, trust_score, created_at)**
    
- **partners(id, biz_no, name, addr, geo, policy_zero_pack, deposit_enabled, trust_score)**
    
- **items(id, partner_id, name, volume_l, weight_kg, allergens, base_price)**
    
- **offers(id, item_id, qty, sale_price, pickup_start, pickup_end, pack_type[none,reuse,disposable])**
    
- **orders(id, user_id, offer_id, qty, status[pending/paid/picked/canceled], mode_walk/bike/bus, created_at)**
    
- **pickups(id, order_id, planned_eta, actual_at, verify_qr, verify_pin, delegate_user_id)**
    
- **pickup_share_tokens(id, order_id, token, expires_at, status)**
    
- **route_plans(id, user_id, start_loc, start_time, return_home, mode, plan_json, distance_km, duration_min)**
    
- **eco_actions(id, user_id, order_id, type[food_waste|packaging|delivery], value, unit, co2e_g)**
    
- **eco_factors(id, type, sub_type, region, factor, unit, valid_from, valid_to)**
    
- **points_ledger(id, user_id, action_id, points, reason, created_at)**
    
- **containers(id, code, type, deposit, state[in_use/returned/lost])**
    
- **container_cycles(id, container_id, user_id, partner_id, out_at, in_at)**
    
- **donations(id, partner_id, item_id, qty, org_id, slot_time, status)**
    
- **notifications(id, user_id, type, payload, sent_at, read_at)**
    

---

## 12. API 설계(예시, FastAPI)

- **Auth**: /auth/signup, /auth/login, /auth/social/callback
    
- **탐색**: /offers/search?lat&lng&radius&time&pack_type
    
- **주문**: POST /orders → GET /orders/{id} → POST /orders/{id}/cancel
    
- **픽업**: POST /pickups/{orderId}/confirm (QR/PIN), GET /pickups/my
    
- **플랜**: POST /routes (출발·모드·귀가 여부) → PATCH /routes/{id} (경로 재최적화)
    
- **주변추천**: GET /routes/{id}/nearby-offers
    
- **대리픽업**: POST /orders/{id}/share-token → POST /share/{token}/accept
    
- **포인트/환경**: GET /me/eco-stats, GET /me/points
    
- **대시보드**: GET /public/eco-stats?region=동&period=monthly
    
- **파트너**: POST /partners/offers, PATCH /partners/offers/{id}, GET /partners/settlements
    
- **기부**: POST /partners/donations, GET /admin/donations
    

---

## 13. 기술 아키텍처

- **FE**: React(+Vite), 지도 SDK(Leaflet/Mapbox), PWA 지원
    
- **BE**: FastAPI, **PostgreSQL**, **Redis**(세션/캐시), **OSRM/GraphHopper**(경로)
    
- **배치/잡**: Celery/Redis로 집계·포인트 산정·대시보드 업데이트
    
- **스토리지**: S3 호환(Object Storage) – 이미지
    
- **인증**: OAuth(구글/카카오)→ JWT. (확장: Keycloak 전환 가능)
    
- **관측성**: 구조화 로그, 메트릭(감축량/성능) 대시보드(Grafana)
    

---

## 14. 데이터·검증 로직

- **환경 계수 관리**: eco_factors 테이블로 지역/항목/기간별 버전 관리
    
- **이동수단 검증**: GPS 속도/가속 특성으로 모드 추정(스푸핑 탐지는 보수적)
    
- **제로포장 검증**: 매장 측 카운터앱에서 포장 타입 선택 + 현장 사진(선택)
    
- **다회용기 루프**: container code 스캔, 보증금 정산(반납 시 자동 환불)
    

---

## 15. 운영 정책(핵심)

- **노쇼**: 1회 경고, 반복 시 예치금·포인트 페널티
    
- **환불**: 픽업 전 시간창 내 취소는 전액/부분 환불(매장 정책 연동)
    
- **품질**: 식중독 등 중대 이슈 즉시 판매 중지·조사·환불; 신고 채널 상시 운영
    
- **프라이버시**: 대시보드는 비식별 집계만 공개, 임계치 미만 비공개
    

---

## 16. KPI & 실험 지표(초기)

- DAU/WAU, 첫 구매까지 시간, **픽업 완료율**, 평균 이동거리/시간
    
- **감축량(kg CO₂e)**, 포장 절감 개수, 다회용기 회수율
    
- 파트너 잉여 판매율, 기부 전환율, 노쇼율
    

---

## 17. MVP 범위(3~4주 스코프 가이드)

- 가입/로그인, 동네 설정, 지도·리스트 탐색
    
- 잉여 상품 등록/구매/픽업(QR/PIN)
    
- **픽업 플랜(도보/자전거) 기본 최적화 + 주변추천**
    
- **환경 포인트(간이 계수)**, 내 대시보드, **공개 대시보드(월 단위)**
    
- **대리 픽업 토큰**(1회용, 만료)
    

---

## 18. 로드맵(요약)

- **v0.4**: 다회용기 보증금 루프, 날씨 연동 준비물 추천
    
- **v0.5**: 버스/지하철 모드 추가, 노쇼 예측(간단 ML)
    
- **v0.6**: 기부 워크플로우, 기관용 포털, 환경 계수 지역화
    

---

## 19. 계산식 초안(참고)

- **CO₂e 총절감** = 음식폐기_절감_CO₂e + 포장재_절감_CO₂e + 배달회피_CO₂e
    
    - 음식폐기_절감_CO₂e = _판매량(kg)_ × _계수_food(지역)_
        
    - 포장재_절감_CO₂e = Σ(항목_개수 × 항목별_계수)
        
    - 배달회피_CO₂e = _대체거리(km)_ × _차량계수(g/km)_ − _실제모드 계수_
        
- **환경 포인트** = ⌊CO₂e 총절감(g) / 10⌋ (예: 10g당 1P) ※ 추후 보정
    

---

## 20. 보안·부정 방지

- 토큰·QR **1회용/단기 만료**, 서버 서명 검증
    
- GPS 스푸핑·속도 이상치 탐지(보수적 포인트 지급)
    
- 리뷰 대신 **정량 지표** 중심 공개, 어뷰징 방지 알림
    

---

## 21. 체크리스트(착수)

-  환경 계수 **초기값 표**(food/packaging/vehicle) 정리
    
-  OSRM 컨테이너 구성, ETA API 래퍼
    
-  데이터 스키마·마이그레이션
    
-  파트너 온보딩 문서(제로포장/다회용 가이드)
    
-  개인정보/약관/환불·노쇼 정책 초안
    

---

### 부록 A. 경로 재최적화 의사코드(간략)

```
input: current_route, new_stops, time_windows, mode
route ← insert_by_min_increase(current_route, new_stops)
route ← two_opt(route)
route ← repair_time_window(route, penalties)
return route
```

### 부록 B. 대리 픽업 토큰 구조(예)

```
{
  orderId: 1234,
  token: "uuid",
  sig: "HMAC(base64)",
  exp: 1735689600,
  scope: ["pickup:confirm"],
  pin: 6자리 숫자
}
```